
include:
    - .docker/compose-db.yml


services:

    ##########
    # APACHE #
    ##########

    apache:
        container_name: symplay
        # docker build -f ".docker\Dockerfile" --pull -t fullstack-play-apache:latest ".docker" 
        image: fullstack-play-apache:latest
        # build:
        #     context: .
        #     dockerfile: .docker/php.Dockerfile
        restart: always
        user: 1000:1000
        ports: 
            - 8001:80   # apache
            - 8080:8080 # npm dev server (must match weback config)
            - 8003:81   # symfony server if needed
        volumes:
            - ./apps/symfony:/var/www/application
            - .docker/symfony/server/apache2/000-default.conf:/etc/apache2/sites-enabled/000-default.conf:ro
            - .docker/symfony/server/php/conf.d/php-custom.ini:/usr/local/etc/php/conf.d/php-custom.ini:ro
            # - .docker/server/php/conf.d/xdebug.ini:/usr/local/etc/php/conf.d/xdebug.ini:ro
            # - .docker/server/apache/my-extra:/usr/local/apache2/conf/my-extra:ro

    ########
    # NODE #
    ########

    node:
        image: node:20
        container_name: nodeground
        restart: always
        user: 1000:1000
        working_dir: /var/www/application
        volumes:
            - ./apps/react:/var/www/application
        command: sleep infinity
        ports:
            - 5173:5173 # npm dev server

    ### TRAEFIK
    # @https://doc.traefik.io/traefik/getting-started/quick-start
    # @http://localhost:8080/api/rawdata
    # traefik:
    #     container_name: traefik
    #     # The official v2.8 Traefik docker image
    #     image: traefik:v2.7
    #     # Enables the web UI and tells Traefik to listen to docker
    #     command:
    #         --api.insecure=true
    #         --providers.docker
    #     #      --entrypoints.websecure.address=:443
    #     # ports:
    #     #     # The HTTP port
    #     #     - "80:80"
    #     #     # The Web UI (enabled by --api.insecure=true)
    #     #     - "8080:8080"
    #     volumes:
    #         # So that Traefik can listen to the Docker events
    #         - /var/run/docker.sock:/var/run/docker.sock
    #         # -> on services
    #     labels:
    #         - "traefik.http.routers.front.rule=Host(`front`)"

######################
# Other useful boxes #
# https://devilbox.org
# https://easyphp.org
# https://laradock.io
# https://laragon.org
# https://github.com/laraedit/laraedit-docker
# https://hub.docker.com/r/mattrayner/lamp
######################
